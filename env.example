# ============================================
# Nameshare Backend Environment Configuration
# ============================================
# Copy this file to .env and update the values for your environment
# Format: <SECTION>__<KEY>=<value>
# Double underscore (__) is used to represent nested config structure

# ============================================
# Server Configuration
# ============================================
SERVER__HOST=0.0.0.0
SERVER__PORT=3001
SERVER__WS_PATH=/ws

# ============================================
# Redis Configuration
# ============================================
# For local development: redis://localhost:6379
# For Docker Compose: redis://redis:6379
# For Upstash Redis (TLS): Use REDIS_URL instead (e.g., rediss://default:password@host:port)
# 
# Option 1: Nested config format (REDIS__URL)
REDIS__URL=redis://localhost:6379
# Option 2: Upstash format (REDIS_URL) - takes precedence if REDIS__URL is empty
# REDIS_URL=rediss://default:password@your-upstash-host:port
REDIS__MAX_CONNECTIONS=16

# ============================================
# Session Configuration
# ============================================
# Default TTL for sessions in seconds (10 minutes)
SESSION__DEFAULT_TTL_SECONDS=600
# Maximum allowed TTL for sessions in seconds (1 hour)
SESSION__MAX_TTL_SECONDS=3600
# Whether sessions are single-use by default
SESSION__SINGLE_USE_DEFAULT=true
# Maximum number of participants per session
SESSION__MAX_PARTICIPANTS=2

# ============================================
# Rate Limiting Configuration
# ============================================
# Maximum join attempts per IP address within the time window
RATE_LIMIT__JOIN_ATTEMPTS_PER_IP=10
# Time window for IP-based rate limiting in seconds
RATE_LIMIT__JOIN_WINDOW_SECONDS=60
# Maximum join attempts per code within the time window
RATE_LIMIT__JOIN_ATTEMPTS_PER_CODE=5
# Time window for code-based rate limiting in seconds (5 minutes)
RATE_LIMIT__JOIN_CODE_WINDOW_SECONDS=300
# Maximum WebSocket messages per minute per connection
RATE_LIMIT__WS_MESSAGES_PER_MINUTE=100

# ============================================
# TURN/STUN Server Configuration
# ============================================
# STUN servers (comma-separated list)
# Example: stun:stun.l.google.com:19302,stun:stun1.l.google.com:19302
TURN__STUN_SERVERS=stun:stun.l.google.com:19302

# TURN servers (JSON array format)
# Uncomment and configure for production TURN servers
# Example format:
# TURN__TURN_SERVERS=[{"urls":["turn:example.com:3478"],"username":"user","credential":"pass"}]
# TURN__TURN_SERVERS=[]

# ============================================
# CORS Configuration
# ============================================
# Configure allowed origins for CORS (Cross-Origin Resource Sharing)
# 
# IMPORTANT: For production, NEVER use wildcard (*)!
# 
# Options:
# 1. Single origin (recommended for production):
#    CORS__ALLOWED_ORIGIN=https://yourdomain.com
#
# 2. Multiple origins (comma-separated, for multi-domain deployments):
#    CORS__ALLOWED_ORIGIN=https://yourdomain.com,https://www.yourdomain.com,https://app.yourdomain.com
#
# 3. Development with multiple local IPs (useful for testing on LAN):
#    CORS__ALLOWED_ORIGIN=http://localhost:3000,http://192.168.1.8:3000,http://127.0.0.1:3000
#
# 4. Wildcard (⚠️ DEVELOPMENT ONLY - NOT SECURE FOR PRODUCTION):
#    CORS__ALLOWED_ORIGIN=*
#
# Current setting (change this for production!):
CORS__ALLOWED_ORIGIN=http://localhost:3000,http://192.168.1.8:3000

# ============================================
# WebSocket Configuration
# ============================================
# Base URL for WebSocket connections (without port)
# For development: ws://localhost
# For production with reverse proxy: wss://yourdomain.com
WEBSOCKET__BASE_URL=ws://localhost
# Size of the broadcast channel buffer for each WebSocket connection
WEBSOCKET__CHANNEL_SIZE=100
# Maximum message size in bytes (64KB default, recommended for WebRTC signaling)
WEBSOCKET__MAX_MESSAGE_SIZE_BYTES=65536
# Heartbeat interval in seconds (ping/pong to detect dead connections)
WEBSOCKET__HEARTBEAT_INTERVAL_SECONDS=30
# Connection timeout in seconds (auto-disconnect idle connections)
WEBSOCKET__CONNECTION_TIMEOUT_SECONDS=300

# ============================================
# Code Generator Configuration
# ============================================
# Minimum delay in milliseconds when code collision occurs (retry delay)
CODE_GENERATOR__COLLISION_DELAY_MIN_MS=10
# Maximum delay in milliseconds when code collision occurs (retry delay)
CODE_GENERATOR__COLLISION_DELAY_MAX_MS=50

# ============================================
# Security Configuration (REQUIRED)
# ============================================
# Master HMAC key for code verification (REQUIRED)
# Generate a secure random key: openssl rand -hex 32
# IMPORTANT: Change this in production!
SECURITY__MASTER_HMAC_KEY=your-secret-hmac-key-change-this-in-production
# Maximum number of retries when generating unique codes
SECURITY__CODE_RETRY_MAX=100
# TTL for code locks in seconds (prevents concurrent code generation)
SECURITY__CODE_LOCK_TTL_SECONDS=10
